apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: carrier-peer0
  namespace: argocd
spec:
  project: default
  source:
    repoURL: https://github.com/Karthikey22/bevel.git
    path: platforms/hyperledger-fabric/charts/peernode
    targetRevision: HEAD
    helm:
      releaseName: carrier-peer0
      values: |-
          metadata:
            namespace: carrier-net
            images:
              couchdb: hyperledger/fabric-couchdb:0.4.22 #prev hyperledger/fabric-couchdb:0.4.18
              peer: hyperledger/fabric-peer:1.4.8
              alpineutils: index.docker.io/hyperledgerlabs/alpine-utils:1.0
              
          peer:
            name: peer0
            gossippeeraddress: peer0.carrier-net:7051
            gossipexternalendpoint: peer0.carrier-net:7051
            localmspid: carrierMSP
            loglevel: info
            tlsstatus: true
            builder: hyperledger/fabric-ccenv:1.4.8
            couchdb:
              username: carrier-user

          storage:
            peer:
              storageclassname: carriersc
              storagesize: 512Mi
            couchdb:
              storageclassname: carriersc
              storagesize: 1Gi

          vault:
            role: vault-role
            address: http://52.229.229.54:8200
            authpath: localcarrier-net-auth
            secretprefix: secretsv2/data/crypto/peerOrganizations/carrier-net/peers/peer0.carrier-net
            secretambassador: secretsv2/data/crypto/peerOrganizations/carrier-net/ambassador
            serviceaccountname: vault-auth
            imagesecretname: regcred
            secretcouchdbpass: secretsv2/data/credentials/carrier-net/couchdb/carrier?user

          service:
            servicetype: ClusterIP
            ports:
              grpc:
                clusteripport: 7051
              events:
                clusteripport: 7053
              couchdb:
                clusteripport: 5984
                      
          proxy:
            provider: "none"
            external_url_suffix: upgrade.upgrade.com

          config:
            pod:
              resources:
                limits:
                  memory: 512M
                  cpu: 1
                requests:
                  memory: 512M
                  cpu: 0.5
  destination:
    server: "https://kubernetes.default.svc"
    namespace: carrier-net
  syncPolicy:
    automated:
      # Do not enable pruning yet!
      prune: false # Specifies if resources should be pruned during auto-syncing ( false by default ).
      selfHeal: true
